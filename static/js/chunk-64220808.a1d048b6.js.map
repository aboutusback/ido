{"version":3,"sources":["webpack:///./src/views/idob/record/index.vue?9599","webpack:///./src/views/idob/record/index.vue","webpack:///./src/views/idob/record/index.vue?3feb"],"names":["class","title","t","type","dataOrders","isExist","amount","receiveProfit","earned","release","$dateformat","time","$t","allowMultiple","components","Header","setup","proxy","store","data","address","state","accounts","web3","provider","handleContract","usdtContract","backContract","leaderAddress","user","btnInherit","loading","initContract","eth","Contract","config","usdtAddress","backAddress","handleAbi_b","HANDLE_b","initData","userOrderFetch","ToastUserOrder","duration","methods","userOrder","call","from","Number","ordersFetch","clear","$errorformat","orderid","ToastOrdersr","decimals","decimalsUSDT","decimalsBACK","orders","idoPrice","oneProfit","price","dividedBy","toFixed","income","multipliedBy","minus","inheritHandle","redeem","estimateGas","send","val","refData","render","__scopeId"],"mappings":"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","file":"static/js/chunk-64220808.a1d048b6.js","sourcesContent":["export * from \"-!../../../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../../../node_modules/vue-loader-v16/dist/stylePostLoader.js!../../../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../../../node_modules/vue-loader-v16/dist/index.js??ref--0-1!./index.vue?vue&type=style&index=0&id=acb8a6c2&lang=less&scoped=true\"","<template>\r\n  <div class=\"container record\">\r\n    <Header :title=\"t('index.購買記錄')\" type=\"back\"></Header>\r\n    <div class=\"lists\">\r\n      <div class=\"li\" v-if=\"dataOrders.isExist\">\r\n        <div class=\"title flex-middle\">\r\n          <div class=\"left flex-item\">{{t('index.IDO訂單/支付{key}',{key:dataOrders.amount+'U'})}}</div>\r\n          <!-- <div class=\"right\">\r\n            <van-button v-if=\"dataOrders.leaderAddress === address\" size=\"mini\" type=\"primary\" class=\"btn\" :loading-text=\"$t('index.退回')\" :loading=\"btnInherit.loading\" :disabled=\"btnInherit.loading\" @click=\"inheritHandle()\">{{$t('index.退回')}}</van-button>\r\n          </div> -->\r\n        </div>\r\n        <div class=\"p\">\r\n          <div class=\"key\">{{t('index.已領取')}}</div>\r\n          <div class=\"value flex-item\">{{dataOrders.receiveProfit}} Back</div>\r\n        </div>\r\n        <div class=\"p\">\r\n          <div class=\"key\">{{t('index.待領取')}}</div>\r\n          <div class=\"value flex-item\">{{dataOrders.earned}} Back</div>\r\n        </div>\r\n        <div class=\"p\">\r\n          <div class=\"key\">{{t('index.待釋放')}}</div>\r\n          <div class=\"value flex-item\">{{dataOrders.release}} Back</div>\r\n        </div>\r\n        <div class=\"p\">\r\n          <div class=\"key\">{{t('index.購買時間')}}</div>\r\n          <div class=\"value flex-item\">{{$dateformat(dataOrders.time)}}</div>\r\n        </div>\r\n      </div>\r\n      <div v-if=\"!dataOrders.isExist\" class=\"noData\">{{$t('暫無更多數據')}}</div>\r\n    </div>\r\n  </div>\r\n</template>\r\n<script>\r\nimport Header from '@/components/Header'\r\nimport { reactive, toRefs, computed, watch, getCurrentInstance } from \"vue\";\r\nimport { useI18n } from \"vue-i18n\";\r\nimport { useStore } from \"vuex\";\r\n\r\nimport { config } from \"@/utils/config\";\r\n// import { MaxUint256 } from \"@ethersproject/constants\";\r\nimport BigNumber from \"bignumber.js\";\r\nimport tokenAbi from \"@/utils/abi.json\";\r\nimport handleAbi_b from \"@/utils/handleAbi_b.json\";\r\nimport { Toast } from \"vant\";\r\nToast.allowMultiple();\r\n// import API from \"@/api\"\r\nexport default {\r\n  components: {\r\n    Header\r\n  },\r\n  setup () {\r\n    const { proxy } = getCurrentInstance();\r\n    const store = useStore()\r\n    const { t } = useI18n()\r\n    const data = reactive({\r\n      t: t,\r\n      address: computed(() => store.state.accounts[0]),\r\n      web3: computed(() => store.state.provider),\r\n      handleContract: null,\r\n      usdtContract: null,\r\n      backContract: null,\r\n      dataOrders: { release: '0', earned: '', amount: '', isExist: '', leaderAddress: '', receiveProfit: '0.0000', time: '', user: '' },\r\n      btnInherit: {\r\n        loading: false\r\n      },\r\n      initContract: () => {\r\n        data.usdtContract = new data.web3.eth.Contract(\r\n          tokenAbi,\r\n          config.usdtAddress\r\n        );\r\n        data.backContract = new data.web3.eth.Contract(\r\n          tokenAbi,\r\n          config.backAddress\r\n        );\r\n        data.handleContract = new data.web3.eth.Contract(\r\n          handleAbi_b,\r\n          config.HANDLE_b\r\n        );\r\n        data.initData()\r\n      },\r\n      initData: () => {\r\n        data.userOrderFetch()\r\n      },\r\n      userOrderFetch: async () => {\r\n        const ToastUserOrder = Toast.loading({\r\n          duration: 0\r\n        })\r\n        try {\r\n          let userOrder = await data.handleContract.methods.userOrder(data.address).call({\r\n            from: data.address\r\n          })\r\n          console.log('userOrder:', userOrder)\r\n          if (!Number(userOrder)) {\r\n            console.log('无订单')\r\n          } else {\r\n            await data.ordersFetch(userOrder)\r\n          }\r\n          ToastUserOrder.clear()\r\n        } catch (error) {\r\n          ToastUserOrder.clear()\r\n          proxy.$errorformat(error)\r\n        }\r\n      },\r\n      ordersFetch: async (orderid) => {\r\n        const ToastOrdersr = Toast.loading({\r\n          duration: 0\r\n        })\r\n        try {\r\n          let decimalsUSDT = await data.usdtContract.methods.decimals().call()\r\n          let decimalsBACK = await data.backContract.methods.decimals().call()\r\n          let orders = await data.handleContract.methods.orders(orderid).call({\r\n            from: data.address\r\n          })\r\n          console.log('orders:', orders)\r\n          let { amount, isExist, leaderAddress, receiveProfit, time, user } = orders\r\n          //  待领取earned  已领取receiveProfit  所有收益oneProfit\r\n          //   待释放= 個人所有收益-待领取-已领取\r\n          let earned = await data.handleContract.methods.earned(data.address).call()\r\n          let idoPrice = await data.handleContract.methods.idoPrice().call({\r\n            from: data.address\r\n          })\r\n          let oneProfit = await data.handleContract.methods.oneProfit().call({\r\n            from: data.address\r\n          })\r\n          let price = new BigNumber(oneProfit).dividedBy(idoPrice).toFixed()\r\n          let income = new BigNumber(amount).multipliedBy(price).toFixed()\r\n          let release = new BigNumber(income).minus(earned).minus(receiveProfit).toFixed()\r\n\r\n          earned = new BigNumber(earned).dividedBy(10 ** decimalsBACK).toFixed(4)\r\n          release = new BigNumber(release).dividedBy(10 ** decimalsBACK).toFixed(4)\r\n          receiveProfit = new BigNumber(receiveProfit).dividedBy(10 ** decimalsBACK).toFixed(4)\r\n          amount = new BigNumber(amount).dividedBy(10 ** decimalsUSDT).toFixed(4)\r\n\r\n          console.log('earned:', earned, 'oneProfit:', oneProfit, 'release:', release)\r\n          data.dataOrders = { release, earned, amount, isExist, leaderAddress, receiveProfit, time, user }\r\n          ToastOrdersr.clear()\r\n        } catch (error) {\r\n          ToastOrdersr.clear()\r\n          proxy.$errorformat(error)\r\n        }\r\n      },\r\n      inheritHandle: async () => {\r\n        console.log('inheritHandle')\r\n        data.btnInherit.loading = true\r\n        try {\r\n          let gas = await data.handleContract.methods.redeem().estimateGas({\r\n            from: data.address\r\n          })\r\n          console.log(gas, 'gas')\r\n          await data.handleContract.methods.redeem().send({\r\n            from: data.address\r\n          })\r\n          data.btnInherit.loading = false\r\n        } catch (error) {\r\n          data.btnInherit.loading = false\r\n          proxy.$errorformat(error)\r\n        }\r\n      }\r\n    })\r\n    if (data.address) {\r\n      data.initContract()\r\n    }\r\n    watch(() => data.address, (val) => {\r\n      if (val) {\r\n        data.initContract()\r\n      }\r\n    })\r\n    const refData = toRefs(data);\r\n    return {\r\n      ...refData\r\n    };\r\n  }\r\n}\r\n</script>\r\n<style lang=\"less\" scoped>\r\n.record {\r\n  padding: 52px 16px 16px;\r\n  .li {\r\n    padding: 17px 12px;\r\n    background: #1a202e;\r\n    border-radius: 8px;\r\n    &:not(:last-child) {\r\n      margin-bottom: 12px;\r\n    }\r\n    .title {\r\n      padding-bottom: 14px;\r\n    }\r\n    .p {\r\n      display: flex;\r\n      align-items: center;\r\n      flex-wrap: wrap;\r\n      &:not(:last-child) {\r\n        margin-bottom: 5px;\r\n      }\r\n      .key {\r\n        font-size: 13px;\r\n        font-family: PingFang SC;\r\n        font-weight: 500;\r\n        color: #ffffff;\r\n      }\r\n      .value {\r\n        text-align: right;\r\n        font-size: 13px;\r\n        font-family: PingFang SC;\r\n        font-weight: 500;\r\n        color: #ffffff;\r\n      }\r\n    }\r\n  }\r\n}\r\n</style>\r\n<style lang=\"less\">\r\n</style>\r\n","import { render } from \"./index.vue?vue&type=template&id=acb8a6c2&scoped=true\"\nimport script from \"./index.vue?vue&type=script&lang=js\"\nexport * from \"./index.vue?vue&type=script&lang=js\"\n\nimport \"./index.vue?vue&type=style&index=0&id=acb8a6c2&lang=less&scoped=true\"\nscript.render = render\nscript.__scopeId = \"data-v-acb8a6c2\"\n\nexport default script"],"sourceRoot":""}